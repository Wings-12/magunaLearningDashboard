@startuml lookerStudioReportStructure
!define LIGHTBLUE #E8F6FF
!define LIGHTGREEN #E8FFEA
!define LIGHTYELLOW #FFF3CD
!define LIGHTGRAY #F8F9FA
!define LIGHTPINK #FFE8EE

skinparam defaultFontName "Meiryo"
skinparam rectangle {
  BackgroundColor #F8F9FA
  BorderColor #333333
  BorderThickness 1
}

title Looker Studio 学習データダッシュボード レポート構成図

' メインレポート群
package "メインレポート群" <<Frame>> #E8FFEA {

  rectangle "学校ダッシュボード" as school_dashboard <<Report>> #E8FFEA {
    rectangle "1: 学年別 平均スコア推移" as p1_school_average_score_trend #FFFFFF
    rectangle "2: クラス別 当月データ一覧" as p2_class_monthly_data_list #FFFFFF
  }

  rectangle "クラスダッシュボード" as class_dashboard <<Report>> #E8FFEA {
    rectangle "1: クラスフィルタ" as filter_class {
      rectangle "2: クラス別 平均スコア推移" as p1_class_average_score_trend #FFFFFF
      rectangle "3: 生徒フィルタ" as filter_student {
        rectangle "4: 生徒 当月データ一覧" as p2_student_monthly_data_list #FFFFFF
        rectangle "5: 生徒別 平均スコア推移" as p3_student_average_score_trend #FFFFFF
      }
    rectangle "6: 先生向けAI学習アドバイス" as teacher_ai_advice {
      rectangle "7: 入力ボックス" as input_box #FFFFFF
      rectangle "8: 出力ボックス" as output_box #FFFFFF
    }

       ' 明示的な位置関係を指定
       p1_class_average_score_trend -[hidden]-> filter_student
       filter_student -[hidden]-> teacher_ai_advice
    }
  }

  ' 明示的な位置関係を指定
  school_dashboard -[hidden]-> class_dashboard
}

' 補助レポート群
package "補助レポート群" <<Frame>> #E8F6FF {

  rectangle "保護者向けレポート" as parent_report <<Report>> #E8F6FF {
    rectangle "お子様の学習状況" as child_progress #FFFFFF
    rectangle "保護者向けAI学習アドバイス" as parent_ai_advice {
      rectangle "入力ボックス" as parent_input_box #FFFFFF
      rectangle "出力ボックス" as parent_output_box #FFFFFF
    }

    child_progress -[hidden]-> parent_ai_advice
  }
}

' 管理・設定系
package "管理・設定系" <<Frame>> #FFF3CD {

  rectangle "アカウント管理" as account_mgmt <<Report>> #FFF3CD {
    rectangle "メインレポートアクセス権限" as main_report_access #FFFFFF
    rectangle "補助レポートアクセス権限" as auxiliary_report_access #FFFFFF
  }
}

' コントロール要素
package "共通コントロール要素" <<Frame>> #F8F9FA {
  rectangle "フィルタ機能" as filters {
    rectangle "期間選択" as filter_period
  }
}

' データフロー
note top of school_dashboard : 起点となるメインレポート\n先生が最初にアクセス\n\n閲覧可能者：先生・英語コーチ
note left of account_mgmt : レポートはつくらずに\n管理者がGoogle Cloudで\nアクセス権限設定
note top of parent_report : 閲覧可能者：保護者・先生・英語コーチ\n\nフィルタリング：メールアドレスでフィルタリングして\n自分の子どもの情報のみ表示

' フィルタ制御
filters -[#9C27B0,dashed]-> school_dashboard : フィルタ適用
filters -[#9C27B0,dashed]-> class_dashboard : フィルタ適用

@enduml